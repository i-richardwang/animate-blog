---
title: Agentic Table Playground
description: AI Agent 驱动的表格处理平台，通过自然语言实现复杂的数据操作
date: 2024-01-10
category: opensource
logo: /projects/github.svg
tech:
  - LangChain
  - Milvus
  - Streamlit
  - Python
  - pandas
links:
  github: https://github.com/i-richardwang/agentic-table-playground
  url: https://agentictableplayground.streamlit.app
featured: false
---

由 LLM Agent 驱动的智能表格处理平台，通过自然语言交互实现复杂的数据操作。Agentic Table Playground 展示了 AI Agent 如何理解用户意图、主动澄清需求、并执行多步骤的数据处理工作流程。支持表格合并、数据重塑、数据比较、垂直堆叠和数据去重等核心功能。

## 系统架构

![系统架构流程图](/projects/table-playground/architecture.png)

系统采用智能决策流程，从用户上传 CSV 文件开始，通过自然语言描述操作需求。AI Assistant 分析用户意图，根据不同情况作出响应：

**意图识别节点** - 系统的核心决策点，判断用户请求是否清晰明确：
- **需要更多信息**: 当意图不明确时，主动请求澄清而非盲目执行
- **可执行操作**: 意图明确时，调用数据操作工具箱中的相应工具
- **超出范围**: 对于不支持的操作，诚实告知用户

**向量检索增强 RAG** - 基于 Milvus 向量数据库的智能检索系统，提升系统对用户意图的理解能力：
- **检索相关工具描述**: 根据用户请求语义搜索最匹配的工具函数，即使表述不标准也能准确识别
- **检索相关示例**: 查找历史相似操作案例，为 AI 提供参考样本，提高操作准确性

**数据操作工具箱** - 包含五大核心功能模块：表格合并、数据重塑、数据比较、垂直堆叠、数据去重。每个工具都封装了完整的数据处理逻辑，通过 pandas 实现高效的表格操作。

## 使用流程

### 1. 数据上传

![数据上传界面](/projects/table-playground/data-upload.png)

上传 CSV 或 Excel 文件后，系统会展示已上传的数据集列表。支持同时上传多个文件，每个文件都会显示文件大小和上传时间。右侧面板实时显示已上传的数据预览，包含数据表的基本信息和前几行数据。

用户可以在输入框中用自然语言描述数据处理需求。系统会根据上传的数据表和用户描述，智能识别需要执行的操作类型。

### 2. 操作执行与结果展示

![操作结果展示](/projects/table-playground/operation-result.png)

当用户输入"帮我把绩效数据按批批到职名单"这样的自然语言请求时，系统会：

1. **理解意图**: 识别这是一个表格合并（JOIN）操作
2. **生成方案**: 确定合并的字段和方式
3. **执行操作**: 调用表格合并工具，使用 pandas 执行 JOIN 操作
4. **展示结果**: 显示合并后的表格"在职名单_with_绩效"

左侧面板显示操作步骤和系统反馈，右侧面板展示操作结果的数据表。用户可以预览结果数据，确认无误后下载 CSV 文件。整个流程通过对话式交互完成，无需编写代码或了解 SQL 语法。

## 核心功能

### 表格合并

匹配两个或多个相关表的信息，类似于 Excel 的 VLOOKUP 或 SQL 的 JOIN 功能。支持多种连接类型：

- **左连接 (Left Join)**: 保留左表所有记录，匹配右表
- **右连接 (Right Join)**: 保留右表所有记录，匹配左表
- **内连接 (Inner Join)**: 只保留两表都匹配的记录
- **外连接 (Outer Join)**: 保留两表的所有记录

系统具有智能列匹配功能，自动识别可用于连接的关键字段。即使用户描述不精确，也能通过向量搜索找到最相关的列进行匹配。

### 数据重塑

灵活调整数据表的结构，适配不同的分析需求：

- **宽表转长表 (Unpivot)**: 将多列合并为一列，增加数据行数。适用于将列标题作为数据值的场景
- **长表转宽表 (Pivot)**: 将一列展开为多列，减少数据行数。适用于制作透视表和交叉分析

自动处理索引和列名，确保重塑后的数据结构清晰可读。

### 数据比较

比较两个表中指定信息的一致性或差异：

- **一致性检查**: 验证两个表中相同字段的值是否匹配
- **差异识别**: 找出不匹配的记录并突出显示
- **缺失检测**: 识别一个表中存在但另一个表中缺失的记录

比较结果会生成详细的差异报告，标注不一致的字段和具体差异内容。

### 垂直堆叠

将多个结构相似的表垂直合并为一个合并表：

- **模式验证**: 自动检查表结构是否兼容
- **列对齐**: 处理列名顺序不一致的情况
- **来源标记**: 可选择性地添加来源表标识列

适用于合并不同时间段、不同来源的同类数据。

### 数据去重

删除重复记录，确保数据唯一性：

- **完全去重**: 删除所有列完全相同的记录
- **字段去重**: 基于指定列的组合判断重复
- **保留策略**: 可选择保留首次出现或最后出现的记录

去重前会显示重复记录的统计信息，帮助用户了解数据质量。

## 技术架构

### 组件栈

- **Frontend**: Streamlit 提供简洁的 Web 界面和实时交互
- **Backend**: Python + pandas 实现高效的表格数据处理
- **AI Engine**: LangChain + OpenAI 提供自然语言理解能力
- **Vector Database**: Milvus 用于工具检索和示例匹配
- **Monitoring**: Langfuse 监控和优化 LLM 调用性能

### 智能决策流程

用户请求 → 自然语言理解 → 意图识别 → 工具检索 → 参数提取 → 操作执行 → 结果展示

系统在每个环节都进行智能判断：
1. **意图识别**: 判断请求是否明确、是否在支持范围内
2. **主动澄清**: 信息不足时，生成针对性的澄清问题
3. **工具选择**: 通过向量搜索匹配最合适的数据操作工具
4. **参数提取**: 从用户描述中提取操作所需的参数（表名、列名、连接方式等）
5. **错误处理**: 操作失败时提供清晰的错误信息和建议

### 向量搜索增强

系统使用 Milvus 向量数据库存储工具函数的描述和示例查询。用户输入问题后，通过语义搜索找到最相关的工具，而不是依赖关键词匹配。

这种设计让系统能够理解同义表达：
- "合并表格" / "联结数据" / "把两个表拼起来" → 表格合并工具
- "删除重复" / "去掉相同的行" / "数据去重" → 数据去重工具
- "改变表结构" / "转置数据" / "列转行" → 数据重塑工具

即使用户的措辞和标准术语不同，系统也能准确理解意图。

## 项目结构

```
agentic-table-playground/
├── backend/                      # 后端核心逻辑
│   ├── tools/                    # 数据操作工具箱
│   │   ├── merge_tool.py         # 表格合并
│   │   ├── reshape_tool.py       # 数据重塑
│   │   ├── compare_tool.py       # 数据比较
│   │   ├── stack_tool.py         # 垂直堆叠
│   │   └── dedupe_tool.py        # 数据去重
│   ├── agent/                    # AI Agent 核心
│   │   ├── intent_classifier.py  # 意图识别
│   │   ├── tool_selector.py      # 工具选择器
│   │   └── clarification.py      # 澄清机制
│   └── data_processor.py         # 数据处理引擎
├── frontend/                     # Streamlit Web UI
│   ├── app.py                    # 应用入口
│   └── components/               # UI 组件
├── utils/                        # 工具函数
│   ├── llm_tools.py              # LLM 工具类
│   ├── vector_store.py           # 向量存储管理
│   └── file_handler.py           # 文件处理
└── data/                         # 数据存储
    ├── uploaded_files/           # 上传文件
    ├── vector_db/                # 向量数据库
    └── results/                  # 结果文件
```

## 适用场景

数据分析师的日常表格处理、业务人员的数据整合任务、数据清洗和预处理工作、快速的数据探索和原型开发、团队协作的数据处理流程。
